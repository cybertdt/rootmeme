<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROOT_MEME | Al Baradi Joy</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DJPTHL77CX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DJPTHL77CX');
    </script>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { background: #050505; color: #e5e5e5; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .meme-grid { column-count: 4; column-gap: 1.25rem; }
        @media (max-width: 1280px) { .meme-grid { column-count: 3; } }
        @media (max-width: 768px) { .meme-grid { column-count: 2; } }
        @media (max-width: 480px) { .meme-grid { column-count: 1; } }

        .meme-card { 
            break-inside: avoid; 
            margin-bottom: 1.25rem; 
            background: #0d0d0d;
            border: 1px solid #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s ease, border-color 0.2s ease;
        }
        .meme-card:hover { border-color: #00ff41; transform: translateY(-3px); }
        
        .header-panel { background: #0a0a0a; border-bottom: 1px solid #1f1f1f; padding: 1rem 2rem; }
        
        .source-tag { font-size: 9px; background: #111; padding: 2px 6px; border-radius: 3px; color: #555; border: 1px solid #222; white-space: nowrap; }
        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-thumb { background: #00ff41; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <header class="sticky top-0 z-50 header-panel flex justify-between items-center backdrop-blur-md bg-opacity-90">
        <div class="flex items-center gap-3">
            <h1 class="text-xl font-black tracking-tighter text-white italic">ROOT_MEME<span class="text-green-500">.IO</span></h1>
            <div class="h-4 w-[1px] bg-zinc-800"></div>
            <p class="text-[9px] font-mono text-zinc-500 uppercase tracking-widest hidden sm:block">Operator: <span class="text-green-500">Al Baradi Joy</span></p>
        </div>

        <div class="flex items-center gap-4">
            <button onclick="fetchMemes()" class="bg-zinc-900 border border-zinc-800 hover:border-green-500 text-zinc-400 hover:text-green-500 p-2 rounded-md transition-all flex items-center gap-2">
                <span class="text-[9px] font-bold uppercase tracking-widest pr-2 hidden md:block">Reload_Nodes</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
            </button>
        </div>
    </header>

    <div class="p-4 max-w-[1600px] mx-auto">
        <div class="mb-6 flex overflow-x-auto gap-2 pb-2 no-scrollbar border-b border-zinc-900">
            <div id="sourceDisplay" class="flex gap-2"></div>
        </div>

        <main id="meme-container" class="meme-grid">
            <div class="h-64 bg-zinc-900/50 rounded-lg animate-pulse mb-4"></div>
            <div class="h-64 bg-zinc-900/50 rounded-lg animate-pulse mb-4"></div>
            <div class="h-64 bg-zinc-900/50 rounded-lg animate-pulse mb-4"></div>
            <div class="h-64 bg-zinc-900/50 rounded-lg animate-pulse mb-4"></div>
        </main>
    </div>

    <script>
        const sources = [
            'programmingmemes', 'programmerhumor', 'devopsmemes', 'networkingmemes',
            'sysadminhumor', 'linuxmemes', 'cybersecuritymemes', 'hackingmemes',
            'netsec', 'masterhacker', 'pwned', 'softwareengineering', 'techsupportgore',
            'sqlmemes', 'itcrowd', 'itprofessional', 'cloudmemes', 'webdevmemes',
            'datacentermemes', 'backendmemes', 'overclocking', 'lowlevel', 'embedded',
            'cryptographymemes', 'ai_memes', 'github'
        ];

        function updateSourceDisplay() {
            const container = document.getElementById('sourceDisplay');
            if (container) {
                container.innerHTML = sources.map(s => `<span class="source-tag">r/${s}</span>`).join('');
            }
        }

        async function fetchMemes() {
            const container = document.getElementById('meme-container');
            try {
                let allMemes = [];
                const activeBatch = [...sources].sort(() => 0.5 - Math.random()).slice(0, 15);
                
                const results = await Promise.allSettled(
                    activeBatch.map(sub => 
                        fetch(`https://meme-api.com/gimme/${sub}/10`).then(r => r.json())
                    )
                );

                results.forEach(res => {
                    if (res.status === 'fulfilled' && res.value.memes) {
                        allMemes = [...allMemes, ...res.value.memes];
                    }
                });

                if (allMemes.length > 0) {
                    allMemes.sort(() => 0.5 - Math.random());
                    render(allMemes);
                }
            } catch (e) {
                console.error("Node error:", e);
            }
        }

        function render(memes) {
            const container = document.getElementById('meme-container');
            container.innerHTML = memes.map(m => `
                <div class="meme-card group">
                    <div class="bg-zinc-950 flex items-center justify-center overflow-hidden min-h-[120px]">
                        <img data-src="${m.url}" 
                             src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" 
                             class="lazy-img w-full h-auto opacity-0 transition-opacity duration-300" 
                             alt="node-data">
                    </div>
                    <div class="p-3 border-t border-zinc-900">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[8px] font-bold text-green-600 uppercase tracking-tighter">${m.subreddit}</span>
                            <span class="text-[8px] text-zinc-700">â–² ${m.ups}</span>
                        </div>
                        <h3 class="text-[10px] text-zinc-400 truncate mb-2">${m.title}</h3>
                        <a href="${m.postLink}" target="_blank" class="block text-center py-1 bg-zinc-900/50 hover:bg-green-900/20 text-[8px] uppercase font-black tracking-widest text-zinc-600 hover:text-green-500 transition-all rounded">Access Node</a>
                    </div>
                </div>
            `).join('');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.onload = () => img.classList.replace('opacity-0', 'opacity-100');
                        observer.unobserve(img);
                    }
                });
            }, { rootMargin: '400px' });

            document.querySelectorAll('.lazy-img').forEach(img => observer.observe(img));
        }

        (function autoInit() {
            updateSourceDisplay();
            fetchMemes();
        })();

        window.onload = () => {
            if (document.getElementById('meme-container').children.length < 10) {
                fetchMemes();
            }
        };
    </script>
</body>
</html>
